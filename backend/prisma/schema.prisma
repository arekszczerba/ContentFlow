generator client {
  provider      = "prisma-client-js"
  binaryTargets = ["native", "linux-musl-openssl-3.0.x"]
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Project {
  id        String   @id @default(uuid())
  name      String
  createdAt DateTime @default(now())
  
  pages     Page[]
  rules     ExtractionRule[]
  patterns  ComponentPattern[]
}

model Page {
  id            String   @id @default(uuid())
  projectId     String
  project       Project  @relation(fields: [projectId], references: [id])
  
  url           String
  title         String?
  language      String?
  targetUrl     String?
  
  legacyTemplate String?
  newTemplate    String?
  
  metaTitle     String?
  metaDesc      String?
  
  status        PageStatus @default(PENDING)
  
  canonicalData      Json?
  detectedComponents Json?

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@unique([projectId, url])
}

model ComponentPattern {
  id          String   @id @default(uuid())
  projectId   String
  project     Project  @relation(fields: [projectId], references: [id])

  selector    String
  
  isLayout    Boolean  @default(false)
  
  componentType CanonicalType @default(UNKNOWN)
  
  confidence  Float    @default(1.0)

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  @@unique([projectId, selector])
}

model ExtractionRule {
  id          String   @id @default(uuid())
  projectId   String
  project     Project  @relation(fields: [projectId], references: [id])

  name        String
  selector    String
  
  ruleType    RuleType @default(GLOBAL)
  
  definitions Json?
  contentType String?
  attribute   String?

  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt
}

enum PageStatus {
  PENDING
  SCRAPED
  ANALYZED
  MAPPED
  EXPORTED
  ERROR
}

enum RuleType {
  GLOBAL
  CONTAINER
  COMPONENT
}

enum CanonicalType {
  UNKNOWN
  HEADER
  RICH_TEXT
  IMAGE
  IMAGE_TEXT
  CTA
  QUOTE
  TABLE
  HERO_BANNER
  AUTHOR_BOX
  RELATED_ARTICLES
  CONTAINER
}